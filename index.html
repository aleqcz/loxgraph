<!doctype html>
<html>
  <head>
    <title>Lox Stats</title>
    <style type=text/css>
      .params {
        width: 100%;
        font-family: monospace;
        font-size: 150%;
      }
    </style>
  </head>
  <body>
    <div id=graph style=width:1550px;height:400px;></div>
    <script src=coffee-script.js></script>
    <script src=jquery-1.9.0.min.js></script>
    <script src=dygraph.js></script>

    <script type=text/coffeescript>
      $ ->
        url = '8145ccd1-7eb6-11e3-8871c2aa1a975e8c.201401.xml'
        $.ajax
          url: url
          dataType: 'html'
          success: (response) ->

            # Parse the xml file and get data
            xmlDoc = $.parseXML(response)
            $xml = $(xmlDoc)
            arr = []
            $xml.find('S').each ->
              timestamp = new Date($(this).attr('T'))
              value = parseFloat($(this).attr('AI1'))
              arr.push [timestamp, value]
              #console.log
              #obj.time =
              #obj.data =

            new Dygraph($('#graph')[0], arr,
              includeZero: true
              delimiter: ';'
              rollPeriod: 1
              showRoller: true
              strokeWidth: 1
              labels: ['Time', 'value']
            )



        dateDelta = (delta) ->
          d = new Date()
          d.setDate(d.getDate()+delta)
          month = d.getMonth()+1
          month = (if month < 10 then '0' else '') + month
          day = d.getDate()
          day = (if day < 10 then '0' else '') + day
          "#{d.getFullYear()}-#{month}-#{day}"

        ###
        draw = ->
          new Dygraph($('#graph')[0], $obj,
            includeZero: true
            delimiter: ';'
            rollPeriod: 1
            showRoller: true
            strokeWidth: 1
          )
        ###

        #g = draw()

        $('#p1').change ->
          g.updateOptions file: buildURL()

        $('#plus').click ->
          g.updateOptions rollPeriod: 1

        rollPeriodUp = ->
          g.updateOptions rollPeriod: g.rollPeriod() * 2 if g.rollPeriod() < 512

        rollPeriodDown = ->
          g.updateOptions rollPeriod: g.rollPeriod() / 2 if g.rollPeriod() > 1

        $(document).keydown (event) ->
            switch event.keyCode
                when 37 # cursor left
                    console.log g.rollPeriod()
                when 39 # cursor right
                    x += 10
                when 38 # cursor up
                    rollPeriodUp()
                when 40 # cursor down
                    rollPeriodDown()
                when 187 # +
                    size += 5
                when 189 # -
                    size -= 5
    </script>
  </body>
</html>
